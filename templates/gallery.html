{% extends "base.html" %}
{% block title %}{{ gallery.title or 'Gallery' }}{% endblock %}
{% block content %}
<div class="container">
    <div class="gallery-view-header">
        <div class="gallery-view-title-section">
            <h1>{{ gallery.title or 'Untitled Gallery' }}</h1>
            {% if gallery.description %}
            <p class="gallery-view-description">{{ gallery.description }}</p>
            {% endif %}
        </div>
        
        <div class="gallery-view-actions">
            <a href="/gallery/{{ gallery.id }}/add-image" class="btn btn-primary">
                <span class="icon">üì∑</span>
                Add Images
            </a>
            <a href="/gallery/{{ gallery.id }}/edit" class="btn btn-secondary">
                <span class="icon">‚úèÔ∏è</span>
                Edit Gallery
            </a>
        </div>
    </div>

    {% if request.query_params.get('message') %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof showToast === 'function') {
                showToast({{ request.query_params.get('message')|tojson }}, 'success');
            }
        });
    </script>
    {% endif %}

    {% if images %}
    <div class="gallery-flex">
        {% for image in images %}
            {% include "partials/_image_card.html" %}
        {% endfor %}
    </div>
    {% else %}
    <div class="gallery-view-empty">
        <div class="gallery-view-empty-icon">üì∏</div>
        <h3>No Images Yet</h3>
        <p>Start building your gallery by adding some images.</p>
        <a href="/gallery/{{ gallery.id }}/add-image" class="btn btn-primary">
            <span class="icon">üì∑</span>
            Add Your First Image
        </a>
    </div>
    {% endif %}

    <div class="gallery-view-footer">
        <a href="/galleries" class="btn btn-secondary">
            <span class="icon">‚Üê</span>
            Back to Galleries
        </a>
    </div>
</div>

<script>
// Image deletion using modal system
function deleteImage(imageId) {
    showDeleteDialog('this image', () => {
        fetch(`/image/${imageId}/delete`, {
            method: 'POST',
            headers: { 'accept': 'application/json' }
        }).then(resp => resp.json()).then(data => {
            if (data.success) {
                document.getElementById(`img-${imageId}`).remove();
            } else {
                showSuccessDialog('Failed to delete image', null, {
                    type: 'warning',
                    title: '‚ö†Ô∏è Error'
                });
            }
        }).catch(() => {
            window.location.reload();
        });
    });
}

// Override the gallery.js delete function
window.showDeleteImageModal = deleteImage;
</script>

<script src="/static/gallery.js"></script>
{% endblock %}
